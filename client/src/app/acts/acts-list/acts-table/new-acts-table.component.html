<div class="container">
  <mat-expansion-panel class="panel">
    <mat-expansion-panel-header>
      <mat-panel-title>
        Фильтры
      </mat-panel-title>
    </mat-expansion-panel-header>
    <div class="rawMenu">
      <mat-card class="card-item">
        <mat-card-header>
          <mat-card-title>
            Столбцы
          </mat-card-title>
          <mat-checkbox
            [checked]="allColumnActive"
            [indeterminate]="someActive()"
            (change)="setAll($event.checked)"
          >
            Все
          </mat-checkbox>
        </mat-card-header>
        <mat-card-content>
          <div cdkDropList (cdkDropListDropped)="drop($event)">
            <mat-chip-list
              *ngFor="let column of columnsToDisplay"
              cdkDrag
              class="drag"
            >
              <mat-chip class="chip-item">
                <mat-checkbox
                  class="checkbox"
                  [(ngModel)]="column.isActive"
                  (ngModelChange)="updateAllComponent()"
                >
                </mat-checkbox>
                <mat-icon>drag_indicator</mat-icon>
                {{ column.label }}
              </mat-chip>
            </mat-chip-list>
          </div>
        </mat-card-content>
      </mat-card>
      <mat-card>
        <mat-card-header>
          <mat-card-title>
            Фильтры
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <section class="rawFileters" *ngIf="filterOptions">
            <div
              *ngFor="let option of filterOptions"
              class="fileterItem"
              [ngSwitch]="option.controlType"
            >
              <mat-chip
                class="chip-filter-item"
                [selectable]="true"
                [removable]="option.isActive"
                (removed)="removeFilter(option)"
              >
                {{ option.label }}
                <mat-icon matChipRemove *ngIf="option.isActive"
                  >cancel</mat-icon
                >
              </mat-chip>
              <div class="options-items">
                <div *ngSwitchCase="'Consumer'">
                  <div *ngFor="let item of option.items">
                    <mat-checkbox
                      [(ngModel)]="item.isChecked"
                      (ngModelChange)="updateFilter($event, option.key)"
                      [disabled]="item.disabled"
                    >
                      {{ item.lable }}
                    </mat-checkbox>
                  </div>
                </div>
                <div *ngSwitchCase="'Date'">
                  <mat-form-field appearance="fill">
                    <mat-lable>Введите дату</mat-lable>
                    <mat-date-range-input
                      [rangePicker]="picker"
                      [formGroup]="rangeFilter"
                    >
                      <input
                        matStartDate
                        formControlName="start"
                        placeholder="От"
                      />
                      <input
                        matEndDate
                        formControlName="end"
                        placeholder="До"
                      />
                    </mat-date-range-input>
                    <mat-datepicker-toggle
                      matSuffix
                      [for]="picker"
                    ></mat-datepicker-toggle>
                    <mat-date-range-picker #picker></mat-date-range-picker>
                  </mat-form-field>
                </div>
              </div>
            </div>
          </section>
        </mat-card-content>
      </mat-card>
    </div>
  </mat-expansion-panel>

  <table
    mat-table
    [dataSource]="dataSource"
    class="mat-elevation-z8"
    matSort
    multiTemplateDataRows
  >
    <!-- Checkbox Column -->
    <ng-container matColumnDef="select">
      <th mat-header-cell *matHeaderCellDef>
        <mat-checkbox
          (change)="$event ? masterToggle() : null"
          [checked]="selection.hasValue() && isAllSelected()"
          [indeterminate]="selection.hasValue() && !isAllSelected()"
          [aria-label]="checkboxLabel()"
        >
        </mat-checkbox>
      </th>
      <td mat-cell *matCellDef="let row">
        <mat-checkbox
          (click)="$event.stopPropagation()"
          (change)="$event ? selection.toggle(row) : null"
          [checked]="selection.isSelected(row)"
          [aria-label]="checkboxLabel(row)"
        >
        </mat-checkbox>
      </td>
    </ng-container>

    <ng-container
      [matColumnDef]="column.key"
      *ngFor="let column of columnsToDisplay"
    >
      <th mat-header-cell *matHeaderCellDef mat-sort-header>
        {{ column.label }}
      </th>
      <td mat-cell *matCellDef="let element" [ngSwitch]="column.controlType">
        <div *ngSwitchCase="'ACT'">
          <button mat-icon-button *ngIf="element[column.key]">
            <mat-icon>cloud_download</mat-icon>
          </button>
        </div>
        <div *ngSwitchCase="'ACT_PDF'">
          <button mat-icon-button *ngIf="element[column.key]">
            <mat-icon>cloud_download</mat-icon>
          </button>
        </div>
        <div *ngSwitchCase="'PROTOCOL'">
          <button mat-icon-button *ngIf="element[column.key]">
            <mat-icon>cloud_download</mat-icon>
          </button>
        </div>
        <div *ngSwitchCase="'Consumer'">
          {{ element ? element[column.key] : null }}
        </div>
        <div *ngSwitchCase="'Date'">
          {{ element ? element[column.key] : null }}
        </div>
      </td>
    </ng-container>

    <ng-container matColumnDef="expandedDetail">
      <td
        mat-cell
        *matCellDef="let element"
        [attr.colspan]="columnsToDisplay.length"
      >
        <div
          class="element-detail"
          [@detailExpand]="
            element == expandedElement ? 'expanded' : 'collapsed'
          "
        >
          <ng-container *ngIf="element === expandedElement">
            <app-row-detail [actId]="element.id"></app-row-detail>
          </ng-container>
        </div>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr
      mat-row
      *matRowDef="let element; columns: displayedColumns"
      class="element-row"
      [class.expanded-row]="expandedElement === element"
      (click)="expandedElement = expandedElement === element ? null : element"
    ></tr>
    <tr
      mat-row
      *matRowDef="let row; columns: ['expandedDetail']"
      class="detail-row"
    ></tr>
  </table>

  <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]"></mat-paginator>
</div>
